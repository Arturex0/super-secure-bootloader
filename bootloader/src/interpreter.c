#include <stdlib.h>
#include <stdio.h>

#define TAPE_SIZE 50
#define STACK_SIZE 100

void load_tape(unsigned char *tape, uint8_t *encrypted_arr, uint8_t size) {
    for (uint8_t i = 0; i < size; i++) {
        tape[i] = encrypted_arr[i];
    }
}

void save_tape(unsigned char *tape, uint8_t *encrypted_arr, uint8_t size) {
    for (uint8_t i = 0; i < size; i++) {
        encrypted_arr[i] = tape[i];
    }
}


void decrypt_bf(uint8_t *encrypted_arr, uint8_t size) {

    const char code[] = {'[', '>', ']', '>', '[', '-', '>', ']', '>', '>', '>', '>', '>', '>', '>', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '>', '+', '+', '+', '+', '+', '+', '+', '0', '[', '[', '>', ']', '<', '[', '>', '+', '<', '-', ']', '0', ']', '+', '+', '+', '+', '+', '+', '[', '[', '[', '>', ']', '<', '[', '>', '+', '<', '-', ']', '0', ']', '>', '[', '<', '+', '>', '-', ']', '+', '<', '-', ']', '0', '>', '>', '>', '>', '>', '>', '[', '-', '<', ']', '>', '>', '>', '>', '+', '+', '+', '+', '>', '+', '+', '+', '+', '>', '>', '>', '[', '<', '<', '+', '>', '>', '-', ']', '0', '>', '>', '>', '>', '>', '^', '[', '0', '>', '>', '>', '>', '^', '+', '0', '>', '>', '>', '>', '>', '^', '-', ']', '0', '>', '>', '>', '>', '+', '>', '+', '+', '0', '>', '>', '>', '>', '>', '^', '[', '0', '>', '[', '>', '^', '[', '>', '+', '<', '-', ']', '0', '>', '>', '-', '<', '-', ']', '0', '>', '>', '>', '>', '>', '^', '[', '0', '>', '>', '>', '>', '^', '+', '0', '>', '>', '>', '>', '>', '^', '-', ']', 'v', '0', '>', '>', '[', '-', ']', '>', '+', '>', '+', '>', '+', '+', '[', '0', '+', '>', '>', '+', '>', '>', '>', '-', ']', '0', '[', '>', '>', '>', '>', '>', '+', '0', '-', ']', '>', '>', '>', '[', '0', '+', '>', '+', '>', '>', '-', ']', '0', '[', '>', '>', '>', '+', '0', '-', ']', '>', '>', '>', '>', '>', '^', ']', '0', '>', '[', '>', '^', '[', '>', '+', '<', '-', ']', '0', '>', '>', '-', '<', '-', ']', '0', '>', '>', '>', '>', '>', '>', '[', '0', '>', '>', '^', '>', '+', '0', '>', '>', '>', '>', '>', '>', '-', ']', '0', '>', '>', '>', '[', '-', ']', '>', '[', '-', ']', '>', '[', '-', ']', '0', '>', '>', '^', '[', '>', ']', '>', '>', '[', '>', ']', '<', '[', '0', '>', '>', '>', '>', '+', '>', '>', '>', '[', '>', ']', '>', '>', '[', '>', ']', '<', '-', ']', '0', '>', '>', '^', '[', '>', ']', '>', '>', '[', '>', ']', '<', '[', '0', '>', '>', '>', '+', '>', '>', '>', '>', '[', '>', ']', '>', '>', '[', '>', ']', '<', '-', ']', '0', '>', '>', '^', '>', '[', '[', '>', ']', '<', '[', '>', '+', '<', '-', ']', '0', '>', '>', '^', '>', ']', '0', '>', '>', '>', '>', '>', '^', '>', '>', '[', '0', '>', '>', '>', '>', '>', '[', '>', '+', '0', '+', '>', '>', '>', '>', '>', '-', ']', '0', '[', '>', '>', '>', '>', '>', '+', '>', '+', '0', '-', ']', '>', '>', '>', '[', '0', '+', '>', '+', '>', '>', '-', ']', '0', '>', '[', '>', '>', '+', '<', '<', '-', ']', '0', '[', '>', '>', '>', '>', '>', '^', '>', '>', '-', '0', '-', ']', '>', '>', '>', '>', '>', '>', '[', '<', '^', '>', '>', '-', '0', '>', '>', '>', '>', '>', '>', '-', ']', '<', '+', '^', '>', '>', ']', '0', '>', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '[', '>', '>', '>', '>', '>', '>', '[', '>', ']', '>', '[', '>', ']', '<', '[', '[', '>', '+', '<', '-', ']', '<', ']', '0', '>', '>', '>', '>', '>', '>', '>', '[', '>', ']', '<', '[', '[', '>', '+', '<', '-', ']', '<', ']', '>', '+', '0', '>', '-', ']', '>', '>', '>', '>', '>', '>', '[', '>', ']', '>', '>', '[', '[', '>', ']', '<', '[', '[', '>', '+', '<', '-', ']', '<', ']', '0', '>', '>', '>', '>', '>', '>', '>', '[', '>', ']', '>', '>', ']', '0', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '[', '-', '<', ']', '<', '<', '[', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '+', '<', '<', '<', '<', '<', '<', '<', '<', '<', '<', '<', '<', '<', '<', '<', '<', '<', '<', '<', '<', '<', '-', ']', '>', '[', '-', ']', '<', '<', '[', '-', ']', '<', '[', '-', ']', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '[', '>', ']', '>', '^', '>', '>', '[', '0', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '[', '>', ']', '>', '[', '0', '+', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '[', '>', ']', '>', '-', ']', '0', '[', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '[', '>', ']', '>', '+', '>', '+', '+', '0', '-', ']', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '[', '0', '+', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '-', ']', '0', '[', '>', '+', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '+', '0', '-', ']', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '[', '>', ']', '>', '>', '[', '0', '>', '+', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '[', '>', ']', '>', '>', '-', ']', '0', '>', '+', '>', '>', '>', '>', '>', '>', '>', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '0', '>', '[', '[', '>', '>', '>', '>', '>', '+', '<', '<', '<', '<', '<', '<', '+', '>', '-', ']', '<', '[', '>', '+', '<', '-', ']', '>', '>', '>', '>', '+', '>', '>', '[', '-', '[', '-', '<', ']', '>', ']', '<', '<', '[', '-', '>', ']', '0', '>', '>', '>', '>', '[', '>', '>', '>', '>', '^', '+', '0', '>', '>', '>', '>', '-', ']', '>', '>', '>', '>', '-', '0', '>', '[', '[', '>', '>', '>', '>', '>', '+', '0', '+', '>', '-', ']', '0', '[', '>', '+', '<', '-', ']', '>', '>', '>', '>', '+', '>', '>', '[', '-', '[', '-', '<', ']', '>', ']', '<', '<', '[', '-', '>', ']', '0', '>', '>', '>', '>', '[', '0', '>', '>', '>', '+', '<', '-', '>', '>', '-', ']', '0', '>', '>', '+', '<', '-', ']', '>', '[', '<', '+', '>', '-', ']', '>', '[', '-', ']', '<', '<', ']', 'v', '0', '>', '>', '>', '>', '>', '>', '>', '>', '[', '-', ']', '+', '+', '+', '+', '+', '+', '+', '+', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '[', '>', ']', '>', '^', '>', '>', '[', '0', '>', '+', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '[', '>', ']', '>', '^', '>', '>', '-', ']', '0', '>', '-', '[', '[', '>', '>', '>', '>', '>', '+', '<', '<', '<', '<', '<', '<', '+', '>', '-', ']', '<', '[', '>', '+', '<', '-', ']', '>', '>', '>', '>', '+', '>', '>', '[', '-', '[', '-', '<', ']', '>', ']', '<', '<', '[', '-', '>', ']', '0', '>', '>', '>', '>', '[', '>', '>', '>', '>', '^', '+', '0', '>', '>', '>', '>', '-', ']', '>', '>', '>', '>', '-', '0', '>', '[', '[', '>', '>', '>', '>', '>', '+', '0', '+', '>', '-', ']', '0', '[', '>', '+', '<', '-', ']', '>', '>', '>', '>', '+', '>', '>', '[', '-', '[', '-', '<', ']', '>', ']', '<', '<', '[', '-', '>', ']', '0', '>', '>', '>', '>', '[', '0', '>', '>', '>', '+', '<', '-', '>', '>', '-', ']', '0', '>', '>', '+', '<', '-', ']', '>', '[', '<', '+', '>', '-', ']', '>', '[', '-', ']', '<', '<', ']', '0', '>', '>', '>', '>', '>', '>', '>', '+', '+', '+', '+', '+', '+', '+', '+', '>', '[', '-', ']', '+', '<', '[', '>', '^', '[', '0', '>', '+', '>', '>', '>', '>', '>', '>', '>', '^', '-', ']', '0', '>', '>', '>', '>', '>', '>', '>', '>', '^', '>', '>', '>', '>', '>', '>', '>', '>', '[', '0', '>', '+', '>', '>', '>', '>', '>', '>', '>', '^', '>', '>', '>', '>', '>', '>', '>', '>', '-', ']', '0', '>', '-', '[', '>', '-', '<', '<', ']', '0', '>', '>', '+', '<', '[', '-', ']', '>', '[', '>', '>', '>', '>', '>', '>', '^', '+', '0', '>', '>', '-', ']', '>', '>', '>', '>', '>', '>', '+', '<', '-', ']', '+', '+', '+', '+', '+', '+', '+', '+', '>', '[', '-', ']', '+', '<', '[', '>', '^', '[', '0', '>', '>', '>', '>', '>', '>', '>', '[', '<', '<', '+', '<', '<', '+', '>', '>', '>', '>', '-', ']', '<', '<', '<', '<', '[', '>', '>', '>', '>', '+', '<', '<', '<', '<', '-', ']', '>', '+', '>', '-', '[', '<', '[', '<', '+', '+', '>', '-', ']', '<', '[', '>', '+', '<', '-', ']', '>', '>', '-', ']', '<', '[', '>', '>', '+', '<', '<', '-', ']', '0', ']', '0', '>', '>', '>', '>', '>', '>', '>', '-', '>', '+', '<', ']', '0', '>', '>', '>', '>', '>', '>', '[', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '[', '>', ']', '>', '^', '>', '>', '+', '0', '>', '>', '>', '>', '>', '>', '-', ']', '0', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '[', '-', ']', '<', '[', '-', ']', '<', '[', '-', ']', '<', '[', '-', ']', '<', '[', '-', ']', '<', '[', '-', ']', '<', '[', '-', ']', '<', '[', '-', ']', '<', '[', '-', ']', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '[', '>', ']', '>', '+', '^', '>', '>', ']', '0', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '>', '[', '-', ']', '>', '>', '[', '>', ']', '>', '[', '-', ']', '>', '>', '[', '[', '<', '+', '>', '-', ']', '>', ']', '<', '<', '[', '<', ']', '>', '[', '[', '<', '+', '>', '-', ']', '>', ']', '0', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '+', '[', '^', '>', '>', '[', '[', '<', '+', '>', '-', ']', '>', ']', '>', '[', '[', '<', '+', '>', '-', ']', '>', ']', '0', '-', ']', '^', '>', '>', '[', '0', '+', '^', '>', '>', ']', '0', '^', '>', '>', '^', '>', '[', '0', '^', '>', '>', '+', '^', '>', ']', '0', '^', '>', '>', '[', '0', '>', '+', '<', '^', '>', '>', '-', ']', '0', '>', '[', '<', '-', '>', '-', ']', '>', '[', '>', ']', '>', '[', '>', ']', '<', '[', '>', '>', '+', '<', '<', '-', ']', '0', '[', '>', '>', '[', '>', ']', '>', '[', '>', ']', '>', '>', '[', '<', '+', '>', '-', ']', '0', '>', '>', '[', '>', ']', '<', '[', '>', '>', '[', '>', ']', '>', '>', '+', '0', '>', '>', '[', '>', ']', '<', '-', ']', '0', '>', '>', '[', '>', ']', '>', '>', '[', '[', '<', '+', '>', '-', ']', '>', ']', '0', '-', ']', '>', '>', '>', '[', '[', '>', ']', '<', '[', '>', '>', '[', '>', ']', '>', '+', '<', '<', '[', '<', ']', '<', '-', ']', '>', '>', '[', '>', ']', '<', '[', '>', '+', '<', '-', ']', '<', '[', '<', ']', '>', '[', '[', '<', '+', '>', '-', ']', '>', ']', '0', '>', '>', '>', ']', '>', '>', '>', '[', '[', '<', '+', '>', '-', ']', '>', ']', '0', '>', '>', '>', '>', '>', '[', '[', '<', '+', '>', '-', ']', '>', ']', '0', '>', '>', '>', '>', '[', '[', '<', '+', '>', '-', ']', '>', ']', '0', '>', '>', '[', '[', '<', '+', '>', '-', ']', '>', ']', '0', '>', '[', '[', '<', '+', '>', '-', ']', '>', ']'};

    unsigned char tape[TAPE_SIZE] = {0};
    unsigned char *ptr = tape;
    const char *loop_start;
    const char *loop_stack[STACK_SIZE];
    int loop_stack_index = 0;

    load_tape(tape, encrypted_arr, size);

    size_t code_index = 0;

    while (code[code_index]) {
        char instruction = code[code_index];
        switch (instruction) {
            case '>':
                ptr++;
                if (ptr >= tape + TAPE_SIZE) ptr = tape; // wrap around
                break;
            case '<':
                if (ptr != tape){
                    ptr--;
                }
                break;
            case '+':
                (*ptr)++;
                break;
            case '-':
                (*ptr)--;
                break;
            case '0':
                ptr = tape;
                break;
            case '^':
                ptr += *ptr;
                break;
            case 'v':
                ptr -= *ptr;
                break;
            case '[':
                if (*ptr == 0) {
                    int loop_count = 1;
                    while (loop_count > 0) {
                        code_index++;
                        if (*code == '[') loop_count++;
                        if (*code == ']') loop_count--;
                    }
                } else {
                    loop_stack[loop_stack_index++] = &code[code_index];
                }
                break;
            case ']':
                if (*ptr != 0) {
                    code_index = loop_stack[loop_stack_index - 1] - code;
                } else {
                    loop_stack_index--;
                }
                break;
            default:
                printf("Invalid instruction!: %c", instruction);
                break;
        }
        code_index++;


    }


    save_tape(tape, encrypted_arr, size);


    printf("[");
    for (int i = 0; i < TAPE_SIZE; i++) {
        printf("%d", tape[i]);
        if (i < TAPE_SIZE - 1) {
            printf(", ");
        }
    }
    printf("]\n");


    
}


   

int main() {
    // Example encrypted array
    uint8_t encrypted_arr[] = {130, 72, 145, 80, 131, 74, 142, 91, 151, 82, 138, 65, 144, 65, 142, 88};
    uint8_t size = sizeof(encrypted_arr) / sizeof(encrypted_arr[0]);
    
    
    decrypt_bf(encrypted_arr, size);

    // Print updated encrypted array
    printf("\nUpdated encrypted array:\n");
    for (uint8_t i = 0; i < size; i++) {
        printf("%d ", encrypted_arr[i]);
    }
    printf("\n");

    return 0;
}